from flask import Flask, request
from twilio.twiml.messaging_response import MessagingResponse

app = Flask(__name__)

# Simples controle financeiro na memÃ³ria
registro = []

@app.route("/mensagem", methods=['POST'])
def mensagem():
    mensagem_recebida = request.form.get('Body')
    resposta = MessagingResponse()

    if mensagem_recebida.lower().startswith("gastei"):
        try:
            valor = float(mensagem_recebida.split(" ")[1])
            registro.append(valor)
            resposta.message(f"âœ… Gastos registrados: R${sum(registro):.2f}")
        except:
            resposta.message("âš ï¸ Envie no formato: *Gastei 20.50*")
    elif mensagem_recebida.lower() == "total":
        resposta.message(f"ğŸ’° Total gasto atÃ© agora: R${sum(registro):.2f}")
    elif mensagem_recebida.lower() == "resetar":
        registro.clear()
        resposta.message("ğŸ§¹ Registros apagados com sucesso!")
    else:
        resposta.message(
            "ğŸ¤– Bot financeiro:\n"
            "â€¢ *Gastei 10.00* para registrar um gasto\n"
            "â€¢ *Total* para ver o quanto vocÃª jÃ¡ gastou\n"
            "â€¢ *Resetar* para apagar os registros"
        )

    return str(resposta)

if __name__ == "__main__":
    app.run(debug=True)
